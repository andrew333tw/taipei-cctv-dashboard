<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
  <meta charset="utf-8" />
  <title>Taipei CCTV Dashboard</title>
  <style>
    .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
    .cctv-item { text-align: center; }
    iframe { width: 100%; height: 240px; border: none; }
    .pagination { margin: 14px 0; text-align: center; }
    .pagination a { margin: 0 4px; text-decoration: none; color: #007bff; }
    .pagination .active { font-weight: bold; text-decoration: underline; }

    /* title + æœå°‹æ¬„ä½ */
    .header-row{ display:flex; justify-content: space-between; align-items:flex-end; }
    .header-title{ flex:1; text-align:center; font-size:32px; font-weight:bold; }

    /* æŠ½å±œ */
    #listDrawer {
      position:fixed;
      left:0; right:0; bottom:-300px;
      height:300px;
      background:#fff;
      border-top:1px solid #ccc;
      overflow:auto;
      transition: bottom 0.3s;
      padding:12px;
      z-index:11;
    }
    #drawerClose{ position:absolute; right:8px; top:8px; cursor:pointer; font-weight:bold; }

    /* èƒŒæ™¯é®ç½© */
    #overlay {
      position:fixed; left:0; top:0; right:0; bottom:0;
      background:rgba(0,0,0,0.4);
      display:none; z-index:10;
    }
    /* è¡¨æ ¼æ¨£å¼ */
    #listDrawer table td{
      padding:4px 10px;
      cursor:pointer;
      white-space:nowrap;
    }
    #listDrawer table td.selected{
      background:#eee;
      cursor:default;
    }
  </style>
</head>
<body>

<!-- header -->
<div class="header-row">
  <div class="header-title">ğŸ¥ å°åŒ—å¸‚CCTVç›£æ§æ¿</div>
  <div>
    <input type="text" id="search" placeholder="æœå°‹ç·¨è™Ÿæˆ–åç¨±"/>
    <button onclick="window.searchCCTV()">æœå°‹</button>
  </div>
</div>

<hr>

<strong>ğŸŸ¡ è‡ªè¨‚ç›£çœ‹æ¸…å–®</strong><br>
<label for="inputCode">è¼¸å…¥ CCTV ç·¨è™Ÿ :</label>
<input type="text" id="inputCode"/>
<button id="addToListBtn">ï¼‹åŠ å…¥</button>
<div id="selectedList" style="margin:5px 0;"></div>
<button id="startCustomBtn" disabled>é–‹å§‹ç›£çœ‹</button>

<hr>

<button id="toggleListBtn">ğŸ“‹ å°åŒ—å¸‚CCTVç·¨è™Ÿåˆ—è¡¨</button>

<div id="overlay"></div>
<div id="listDrawer">
  <span id="drawerClose">âŒ</span>
  <div id="drawerContent"></div>
</div>

<div id="grid" class="grid"></div>
<div id="pagination" class="pagination"></div>

<script src="app.js"></script>
<script>
init();

/* Drawer & Overlay */
let listOpen = false;
const drawer        = document.getElementById('listDrawer');
const overlay       = document.getElementById('overlay');
const drawerContent = document.getElementById('drawerContent');
const closeBtn      = document.getElementById('drawerClose');

document.getElementById('toggleListBtn').onclick = toggleDrawer;
closeBtn.onclick  = toggleDrawer;
overlay.onclick   = toggleDrawer;

function toggleDrawer(){
  // ç¬¬ä¸€æ¬¡å±•é–‹ â†’ å»ºæ§‹ 8æ¬„è¡¨æ ¼
  if(!drawerContent.innerHTML){
    let html = '<table><tr>';
    cctvData.forEach((d,index)=>{
      html+=`<td data-id="${d.id}" onclick="addFromDrawer(this,'${d.id}')">${d.id} ${d.name}</td>`;
      if((index+1)%8===0) html+='</tr><tr>';
    });
    html+='</tr></table>';
    drawerContent.innerHTML = html;
  }

  listOpen = !listOpen;
  drawer.style.bottom   = listOpen ? '0px' : '-300px';
  overlay.style.display = listOpen ? 'block' : 'none';

  // â¬‡ å±•é–‹æ™‚åŒæ­¥æ¨™è¨˜å·²é¸ç·¨è™Ÿ (è®Šç°)
  if(listOpen){
    const tds = drawerContent.querySelectorAll('td');
    tds.forEach(td=>{
      const id = td.getAttribute('data-id');
      if(selectedCodes.includes(id)){
        td.classList.add('selected');
        td.onclick = null;
      }
    });
  }
}

/* é»è¡¨æ ¼ (å¿«é€ŸåŠ å…¥) */
function addFromDrawer(td, code){
  if(!selectedCodes.includes(code)){
    selectedCodes.push(code);
    updateSelectedList();

    // æ¨™è¨˜å·²é¸ (è®Šç°+ç¦ç”¨)
    td.classList.add('selected');
    td.onclick = null;
  }
  document.getElementById('startCustomBtn').disabled = false;
}
</script>
</body>
</html>
